<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PrepAura Nexus — Chat</title>

  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="practice-tool.css" />
  <link rel="stylesheet" href="chatbot.css" />
  <style>
    /* chat page additional styles (cyberpunk blue-cyan) */
    body { background: linear-gradient(180deg,#05060b,#071029); color: #e6f2ff; }
    .chat-wrap {
      max-width: 920px;
      margin: 80px auto;
      padding: 20px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(6,10,20,0.6), rgba(4,6,12,0.65));
      border: 1px solid rgba(58,183,255,0.06);
      box-shadow: 0 20px 60px rgba(2,6,23,0.7);
      min-height: 560px;
    }

    .chat-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
      margin-bottom: 14px;
    }
    .chat-header h2 { margin:0; font-size:1.2rem; color:#dff8ff; }
    .chat-header .sub { color:#9fb9ff; font-size:0.9rem; opacity:.95 }

    .chat-body {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding: 16px;
      border-radius: 10px;
      height: 380px;
      overflow:auto;
      border: 1px solid rgba(255,255,255,0.02);
      margin-bottom: 12px;
    }

    .msg { margin-bottom: 12px; display:flex; gap:10px; align-items:flex-start; }
    .msg.user { justify-content:flex-end; }
    .bubble {
      max-width:76%;
      padding: 12px 14px;
      border-radius: 12px;
      line-height:1.4;
      font-size:0.95rem;
      white-space: pre-wrap;
    }
    .bubble.ai {
      background: linear-gradient(180deg, rgba(58,183,255,0.08), rgba(124,77,255,0.03));
      border:1px solid rgba(58,183,255,0.06);
      color:#e7f7ff;
      box-shadow: 0 8px 30px rgba(56,168,255,0.04);
      border-top-left-radius:4px;
    }
    .bubble.user {
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      color:#ffffff;
      align-self:flex-end;
      border-bottom-right-radius:4px;
    }

    .chat-controls { display:flex; gap:10px; align-items:center; }
    .chat-controls input[type="text"] {
      flex:1;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:#071029;
      color:#e6f2ff;
      font-size:0.98rem;
    }
    .chat-controls button {
      padding:10px 14px;
      border-radius:10px;
      border:none;
      font-weight:700;
      background: linear-gradient(90deg,#3ab7ff,#7c4dff);
      color:white;
      cursor:pointer;
    }

    .meta-note { font-size:0.85rem; color:#9fb9ff; margin-top:10px; }
    .typing { color:#9fb9ff; font-size:0.95rem; margin-left:6px; }

    /* mobile */
    @media (max-width:720px) {
      .chat-wrap { margin: 40px 12px; }
      .chat-body { height: 320px; }
    }
  </style>
</head>
<body>

  <main class="chat-wrap">
    <div class="chat-header">
      <div>
        <h2>PrepAura Nexus</h2>
        <div class="sub">Cyberpunk Assistant — ask anything about the practice tools</div>
      </div>
      <div>
        <button onclick="location.href='practice.html'" class="btn-ghost">Back</button>
      </div>
    </div>

    <div id="chatBody" class="chat-body" aria-live="polite"></div>

    <div class="chat-controls">
      <input id="chatInput" type="text" placeholder="Ask Nexus something (e.g., 'Give me tips on speed math')" />
      <button id="sendBtn">Send</button>
    </div>

    <div class="meta-note">
      Responses are powered via Gemini. This client uses a backend proxy to call the model (your API key stays server-side).
      <span id="typingIndicator" class="typing" style="display:none">Nexus is typing…</span>
    </div>
  </main>

  <script>
    // chat-page script: minimal, uses /api/gemini backend
    (function(){
      const chatBody = document.getElementById('chatBody');
      const input = document.getElementById('chatInput');
      const sendBtn = document.getElementById('sendBtn');
      const typing = document.getElementById('typingIndicator');

      function appendMsg(text, who='ai') {
        const wrap = document.createElement('div');
        wrap.className = 'msg ' + (who === 'user' ? 'user' : 'ai');
        const bubble = document.createElement('div');
        bubble.className = 'bubble ' + (who === 'user' ? 'user' : 'ai');
        bubble.innerHTML = text;
        wrap.appendChild(bubble);
        chatBody.appendChild(wrap);
        chatBody.scrollTop = chatBody.scrollHeight;
      }

      async function sendQuestion(q) {
        if (!q || q.trim()==='') return;
        appendMsg(q, 'user');
        input.value = '';
        typing.style.display = 'inline';
        sendBtn.disabled = true;

        try {
          // NOTE: Replace /api/gemini with your backend endpoint that proxies to Gemini securely.
          const res = await fetch("https://prepmate-backend-x77z.onrender.com/api/gemini", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt: q })
          });

          if (!res.ok) {
            const text = await res.text();
            appendMsg("⚠️ Error: " + res.status + " — " + (text || res.statusText));
            return;
          }
          const json = await res.json();
          // expected json shape: { reply: "..." }
          appendMsg(json.reply || "No reply from model.");
        } catch (err) {
          console.error(err);
          appendMsg("⚠️ Network error. Check backend or internet.");
        } finally {
          typing.style.display = 'none';
          sendBtn.disabled = false;
        }
      }

      sendBtn.addEventListener('click', ()=> sendQuestion(input.value));
      input.addEventListener('keydown', (e)=> { if(e.key === 'Enter') sendQuestion(input.value); });

      // welcome message
      appendMsg("⚡ <strong>Nexus Ready</strong><br>Ask me about practice tips, question strategies, or report interpretation.");
    })();
  </script>
</body>
</html>
